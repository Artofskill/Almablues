<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ ‚Äî AlmaBlues</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <style>
    :root {
      --bg-dark: #001028;
      --chelsea-blue: #034694;
      --chelsea-blue-dark: #002366;
      --gold: #D4A017;
      --gold-hover: #E8B923;
      --text-light: #e0e0e0;
      --white: #ffffff;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Roboto', sans-serif;
      background: var(--bg-dark);
      color: var(--text-light);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      margin-bottom: 2rem;
    }
    
    h1 {
      font-family: 'Oswald', sans-serif;
      color: var(--gold);
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }
    
    .table-info {
      background: rgba(3, 70, 148, 0.2);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .last-updated {
      color: #aaa;
      font-size: 0.9rem;
    }
    
    .refresh-btn {
      background: var(--gold);
      color: var(--bg-dark);
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }
    
    .refresh-btn:hover {
      background: var(--gold-hover);
    }
    
    .table-container {
      overflow-x: auto;
      margin-bottom: 30px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(255, 255, 255, 0.05);
    }
    
    th, td {
      padding: 12px 8px;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    th {
      background: rgba(3, 70, 148, 0.5);
      font-weight: bold;
      position: sticky;
      top: 0;
    }
    
    .chelsea-row {
      background: rgba(3, 70, 148, 0.3) !important;
      font-weight: bold;
      border-left: 4px solid var(--gold);
    }
    
    .position {
      width: 50px;
      font-weight: bold;
    }
    
    .team-name {
      text-align: left;
      min-width: 180px;
      padding-left: 15px !important;
    }
    
    .team-logo {
      width: 24px;
      height: 24px;
      vertical-align: middle;
      margin-right: 10px;
      object-fit: contain;
    }
    
    .form {
      display: flex;
      justify-content: center;
      gap: 3px;
    }
    
    .form-letter {
      width: 20px;
      height: 20px;
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
    }
    
    .form-W { background: #4CAF50; color: white; }
    .form-D { background: #FFC107; color: black; }
    .form-L { background: #f44336; color: white; }
    
    .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 30px;
    }
    
    .stat-card {
      flex: 1;
      min-width: 200px;
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 2.5rem;
      font-weight: bold;
      color: var(--gold);
      margin: 10px 0;
    }
    
    .stat-label {
      color: #aaa;
      font-size: 0.9rem;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--gold);
      font-size: 1.2rem;
    }
    
    .error {
      text-align: center;
      padding: 40px;
      color: #f44336;
    }
    
    .api-status {
      display: inline-block;
      margin-left: 10px;
      font-size: 0.8rem;
      padding: 2px 8px;
      border-radius: 10px;
      background: #4CAF50;
      color: white;
    }
    
    .api-status.offline {
      background: #f44336;
    }
    
    .api-status.cached {
      background: #FFC107;
      color: black;
    }
    
    .requests-info {
      font-size: 0.8rem;
      color: #aaa;
      margin-top: 5px;
    }
    
    footer {
      text-align: center;
      margin-top: 3rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: #777;
      font-size: 0.9rem;
    }
    
    .back-btn {
      display: inline-block;
      margin-top: 1rem;
      color: var(--gold);
      text-decoration: none;
      font-weight: 500;
    }
    
    .back-btn:hover {
      text-decoration: underline;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 0 10px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      th, td {
        padding: 8px 4px;
        font-size: 0.9rem;
      }
      
      .team-name {
        min-width: 150px;
      }
      
      .form-letter {
        width: 18px;
        height: 18px;
        font-size: 0.7rem;
      }
      
      .stat-card {
        min-width: 140px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>AlmaBlues</h1>
      <p>–¢—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ê–ü–õ 2024/25</p>
    </header>
    
    <div class="table-info">
      <div>
        <div style="font-size: 1.1rem; font-weight: bold; color: var(--white);">
          –ê–Ω–≥–ª–∏–π—Å–∫–∞—è –ü—Ä–µ–º—å–µ—Ä-–ª–∏–≥–∞
          <span class="api-status" id="api-status">Live API</span>
        </div>
        <div class="last-updated" id="last-updated">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        <div class="requests-info" id="requests-info">10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –¥–µ–Ω—å (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ)</div>
      </div>
      <button class="refresh-btn" id="refresh-btn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>
    
    <div class="table-container">
      <table id="league-table">
        <thead>
          <tr>
            <th class="position">#</th>
            <th class="team-name">–ö–æ–º–∞–Ω–¥–∞</th>
            <th>–ò</th>
            <th>–í</th>
            <th>–ù</th>
            <th>–ü</th>
            <th>–ó–ú</th>
            <th>–ü–ú</th>
            <th>–†–ú</th>
            <th>–û</th>
            <th>–§–æ—Ä–º–∞</th>
          </tr>
        </thead>
        <tbody id="table-body">
          <tr>
            <td colspan="11" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Football-Data.org...</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div class="stats" id="chelsea-stats">
      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ß–µ–ª—Å–∏ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —á–µ—Ä–µ–∑ JS -->
    </div>
    
    <footer>
      <p>Chelsea FC Supporters Club Kazakhstan ‚Ä¢ 2026 by @Artofskill</p>
      <p style="font-size: 0.8rem; color: #aaa; margin-top: 5px;">–î–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã Football-Data.org ‚Ä¢ –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç</p>
      <a href="dashboard.html" class="back-btn">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –¥–∞—à–±–æ—Ä–¥</a>
    </footer>
  </div>
  
  <script>
    // Telegram WebApp
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();
    
    // –í–∞—à API –∫–ª—é—á –æ—Ç football-data.org
    const API_KEY = 'ff998a96cf104792af475e5baf76964e';
    
    // Football-Data.org API endpoint –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã Premier League
    const API_URL = 'https://api.allorigins.win/raw?url=' + encodeURIComponent('https://api.football-data.org/v4/competitions/PL/standings');
    
    // –ö–ª—é—á–∏ –¥–ª—è localStorage –∫—ç—à–∞
    const CACHE_KEY = 'apl_table_cache';
    const CACHE_TIMESTAMP_KEY = 'apl_table_cache_timestamp';
    const CACHE_DURATION = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç (300000 –º—Å)
    
    // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ API –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–æ
    const demoData = {
      "filters": { "season": "2024" },
      "area": { "id": 2072, "name": "England" },
      "competition": { "id": 2021, "name": "Premier League" },
      "season": { "id": 1564, "currentMatchday": 25 },
      "standings": [
        {
          "stage": "REGULAR_SEASON",
          "type": "TOTAL",
          "table": [
            {
              "position": 1,
              "team": { 
                "id": 65, 
                "name": "Manchester City FC",
                "crest": "https://crests.football-data.org/65.png"
              },
              "playedGames": 24,
              "won": 18,
              "draw": 4,
              "lost": 2,
              "points": 58,
              "goalsFor": 58,
              "goalsAgainst": 22,
              "goalDifference": 36
            },
            {
              "position": 2,
              "team": { 
                "id": 64, 
                "name": "Liverpool FC",
                "crest": "https://crests.football-data.org/64.png"
              },
              "playedGames": 24,
              "won": 17,
              "draw": 6,
              "lost": 1,
              "points": 57,
              "goalsFor": 55,
              "goalsAgainst": 22,
              "goalDifference": 33
            },
            {
              "position": 3,
              "team": { 
                "id": 61, 
                "name": "Chelsea FC",
                "crest": "https://crests.football-data.org/61.png"
              },
              "playedGames": 24,
              "won": 16,
              "draw": 5,
              "lost": 3,
              "points": 53,
              "goalsFor": 52,
              "goalsAgainst": 25,
              "goalDifference": 27
            },
            {
              "position": 4,
              "team": { 
                "id": 57, 
                "name": "Arsenal FC",
                "crest": "https://crests.football-data.org/57.png"
              },
              "playedGames": 24,
              "won": 15,
              "draw": 5,
              "lost": 4,
              "points": 50,
              "goalsFor": 48,
              "goalsAgainst": 26,
              "goalDifference": 22
            },
            {
              "position": 5,
              "team": { 
                "id": 73, 
                "name": "Tottenham Hotspur FC",
                "crest": "https://crests.football-data.org/73.png"
              },
              "playedGames": 24,
              "won": 14,
              "draw": 5,
              "lost": 5,
              "points": 47,
              "goalsFor": 51,
              "goalsAgainst": 36,
              "goalDifference": 15
            }
            // ... –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∫–æ–º–∞–Ω–¥ –¥–ª—è –¥–µ–º–æ
          ]
        }
      ]
    };
    
    // –ü–æ–ª—É—á–∏—Ç—å —Ñ–æ—Ä–º—É –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–∞—Ç—á–µ–π (–≤ football-data.org –Ω–µ—Ç —Ñ–æ—Ä–º—ã –≤ –±–∞–∑–æ–≤–æ–º —Ç–∞—Ä–∏—Ñ–µ)
    // –°–æ–∑–¥–∞–µ–º –¥–µ–º–æ-—Ñ–æ—Ä–º—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–∑–∏—Ü–∏–∏
    function getFormForTeam(position) {
      const forms = {
        1: 'WWWWD', // Manchester City
        2: 'WDWWW', // Liverpool
        3: 'WWLDW', // Chelsea
        4: 'LWWWD', // Arsenal
        5: 'WDLWW', // Tottenham
      };
      
      return forms[position] || '-----';
    }
    
    async function fetchLeagueData() {
      const tableBody = document.getElementById('table-body');
      const lastUpdated = document.getElementById('last-updated');
      const chelseaStats = document.getElementById('chelsea-stats');
      const apiStatus = document.getElementById('api-status');
      const requestsInfo = document.getElementById('requests-info');
      
      try {
        tableBody.innerHTML = '<tr><td colspan="11" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Football-Data.org...</td></tr>';
        
        const response = await fetch(API_URL, {
          method: 'GET',
          headers: {
            'X-Auth-Token': API_KEY,
            'Accept': 'application/json'
          }
        });
        
        if (!response.ok) {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
          if (response.status === 429) {
            throw new Error('–î–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (10 –≤ –¥–µ–Ω—å). –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤—Ç—Ä–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ.');
          }
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        const data = await response.json();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ
        if (!data.standings || data.standings.length === 0 || !data.standings[0].table) {
          throw new Error('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–∞–±–ª–∏—Ü–µ');
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
        saveToCache(data);
        
        apiStatus.textContent = 'Live API';
        apiStatus.className = 'api-status';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        const now = new Date();
        lastUpdated.textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${now.toLocaleString('ru-RU')}`;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–ø—Ä–æ—Å–∞—Ö (–µ—Å–ª–∏ –≤ –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å headers)
        const remainingRequests = response.headers.get('X-Requests-Available');
        const requestCounter = response.headers.get('X-RequestCounter-Reset');
        
        if (remainingRequests) {
          requestsInfo.textContent = `–û—Å—Ç–∞–ª–æ—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–µ–≥–æ–¥–Ω—è: ${remainingRequests}`;
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
        renderTable(data.standings[0].table);
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ß–µ–ª—Å–∏
        const chelsea = data.standings[0].table.find(team => 
          team.team.id === 61 || team.team.name.toLowerCase().includes('chelsea')
        );
        
        if (chelsea) {
          renderChelseaStats(chelsea);
        }
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Football-Data.org:', error);
        
        apiStatus.textContent = '–î–µ–º–æ –¥–∞–Ω–Ω—ã–µ';
        apiStatus.className = 'api-status offline';
        
        tableBody.innerHTML = `
          <tr>
            <td colspan="11" class="error">
              ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
              <div style="margin-top: 10px; font-size: 0.9rem; color: #aaa;">
                ${error.message}
              </div>
              <div style="margin-top: 15px;">
                <button onclick="useDemoData()" style="background: var(--gold); color: var(--bg-dark); border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                </button>
              </div>
            </td>
          </tr>
        `;
        
        lastUpdated.textContent = `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${new Date().toLocaleTimeString('ru-RU')}`;
        
        // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –∫—ç—à–∞
        const cachedData = loadFromCache();
        if (cachedData) {
          setTimeout(() => {
            useCachedData(cachedData);
          }, 1000);
        }
      }
    }
    
    function saveToCache(data) {
      try {
        const cacheData = {
          data: data,
          timestamp: Date.now()
        };
        localStorage.setItem(CACHE_KEY, JSON.stringify(cacheData));
        localStorage.setItem(CACHE_TIMESTAMP_KEY, Date.now().toString());
      } catch (e) {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à:', e);
      }
    }
    
    function loadFromCache() {
      try {
        const cached = localStorage.getItem(CACHE_KEY);
        if (!cached) return null;
        
        const { data, timestamp } = JSON.parse(cached);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É—Å—Ç–∞—Ä–µ–ª–∏ –ª–∏ –¥–∞–Ω–Ω—ã–µ (–±–æ–ª—å—à–µ 24 —á–∞—Å–æ–≤)
        if (Date.now() - timestamp > 24 * 60 * 60 * 1000) {
          localStorage.removeItem(CACHE_KEY);
          localStorage.removeItem(CACHE_TIMESTAMP_KEY);
          return null;
        }
        
        return { data, timestamp };
      } catch (e) {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –∫—ç—à–∞:', e);
        return null;
      }
    }
    
    function useCachedData(cached) {
      const { data, timestamp } = cached;
      const tableBody = document.getElementById('table-body');
      const lastUpdated = document.getElementById('last-updated');
      const apiStatus = document.getElementById('api-status');
      const chelseaStats = document.getElementById('chelsea-stats');
      
      apiStatus.textContent = '–ö—ç—à–∏—Ä–æ–≤–∞–Ω–æ';
      apiStatus.className = 'api-status cached';
      
      lastUpdated.textContent = `–ö—ç—à–∏—Ä–æ–≤–∞–Ω–æ: ${new Date(timestamp).toLocaleString('ru-RU')}`;
      
      renderTable(data.standings[0].table);
      
      const chelsea = data.standings[0].table.find(team => 
        team.team.id === 61 || team.team.name.toLowerCase().includes('chelsea')
      );
      
      if (chelsea) {
        renderChelseaStats(chelsea);
      }
    }
    
    function renderTable(teams) {
      const tableBody = document.getElementById('table-body');
      tableBody.innerHTML = '';
      
      // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–ø-10 –∫–æ–º–∞–Ω–¥ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
      const topTeams = teams.slice(0, 10);
      
      topTeams.forEach(team => {
        const isChelsea = team.team.id === 61 || team.team.name.toLowerCase().includes('chelsea');
        const rowClass = isChelsea ? 'chelsea-row' : '';
        
        // –ü–æ–ª—É—á–∞–µ–º —Ñ–æ—Ä–º—É –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–∞—Ç—á–µ–π
        const form = getFormForTeam(team.position);
        const formLetters = form.split('');
        const formHtml = formLetters.map(letter => 
          `<span class="form-letter form-${letter}">${letter}</span>`
        ).join('');
        
        const row = document.createElement('tr');
        row.className = rowClass;
        row.innerHTML = `
          <td class="position">${team.position}</td>
          <td class="team-name">
            <img src="${team.team.crest || 'https://crests.football-data.org/61.png'}" 
                 alt="${team.team.name}" 
                 class="team-logo"
                 onerror="this.src='https://via.placeholder.com/24/034694/FFFFFF?text=${team.team.name.charAt(0)}'">
            ${team.team.name}
          </td>
          <td>${team.playedGames}</td>
          <td>${team.won}</td>
          <td>${team.draw}</td>
          <td>${team.lost}</td>
          <td>${team.goalsFor}</td>
          <td>${team.goalsAgainst}</td>
          <td>${team.goalDifference}</td>
          <td><strong>${team.points}</strong></td>
          <td>
            <div class="form">${formHtml}</div>
          </td>
        `;
        
        tableBody.appendChild(row);
      });
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É —Å –æ–±—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
      if (teams.length > 10) {
        const infoRow = document.createElement('tr');
        infoRow.innerHTML = `
          <td colspan="11" style="text-align: center; color: #aaa; font-size: 0.9rem; padding: 10px;">
            –ü–æ–∫–∞–∑–∞–Ω—ã —Ç–æ–ø-10 –∫–æ–º–∞–Ω–¥. –í—Å–µ–≥–æ –∫–æ–º–∞–Ω–¥: ${teams.length}
          </td>
        `;
        tableBody.appendChild(infoRow);
      }
    }
    
    function renderChelseaStats(chelsea) {
      const chelseaStats = document.getElementById('chelsea-stats');
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
      const winRate = Math.round((chelsea.won / chelsea.playedGames) * 100);
      const avgGoalsFor = (chelsea.goalsFor / chelsea.playedGames).toFixed(1);
      const avgGoalsAgainst = (chelsea.goalsAgainst / chelsea.playedGames).toFixed(1);
      const cleanSheetRate = Math.round((chelsea.won * 0.7 + chelsea.draw * 0.3) / chelsea.playedGames * 100);
      
      chelseaStats.innerHTML = `
        <div class="stat-card">
          <div class="stat-label">–ü–æ–∑–∏—Ü–∏—è</div>
          <div class="stat-value">${chelsea.position}</div>
          <div class="stat-label">–≤ —Ç–∞–±–ª–∏—Ü–µ</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥</div>
          <div class="stat-value">${winRate}%</div>
          <div class="stat-label">${chelsea.won} –∏–∑ ${chelsea.playedGames}</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-label">–ó–∞–±–∏—Ç—ã–µ –≥–æ–ª—ã</div>
          <div class="stat-value">${chelsea.goalsFor}</div>
          <div class="stat-label">${avgGoalsFor} –∑–∞ –∏–≥—Ä—É</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-label">–†–∞–∑–Ω–∏—Ü–∞ –º—è—á–µ–π</div>
          <div class="stat-value">+${chelsea.goalDifference}</div>
          <div class="stat-label">${chelsea.goalsFor}:${chelsea.goalsAgainst}</div>
        </div>
      `;
    }
    
    function useDemoData() {
      renderTable(demoData.standings[0].table);
      
      const chelsea = demoData.standings[0].table.find(team => 
        team.team.id === 61 || team.team.name.toLowerCase().includes('chelsea')
      );
      
      if (chelsea) {
        renderChelseaStats(chelsea);
      }
      
      document.getElementById('last-updated').textContent = 
        `–î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ (Football-Data.org –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)`;
      document.getElementById('api-status').textContent = '–î–µ–º–æ –¥–∞–Ω–Ω—ã–µ';
      document.getElementById('api-status').className = 'api-status offline';
      document.getElementById('requests-info').textContent = '–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ';
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    async function loadDataWithCache() {
      const cached = loadFromCache();
      
      if (cached && (Date.now() - cached.timestamp < CACHE_DURATION)) {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –æ–Ω–∏ —Å–≤–µ–∂–∏–µ (< 5 –º–∏–Ω—É—Ç)
        useCachedData(cached);
        
        // –í —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
        setTimeout(fetchLeagueData, 1000);
      } else {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        await fetchLeagueData();
      }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.getElementById('refresh-btn').addEventListener('click', loadDataWithCache);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadDataWithCache();
    
    // –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω—ã)
    setInterval(() => {
      const cached = loadFromCache();
      if (!cached || (Date.now() - cached.timestamp >= CACHE_DURATION)) {
        fetchLeagueData();
      }
    }, 5 * 60 * 1000);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
    let requestCount = 0;
    const originalFetch = window.fetch;
    window.fetch = async function(...args) {
      const response = await originalFetch.apply(this, args);
      if (args[0] && args[0].includes('api.football-data.org')) {
        requestCount++;
        
        if (requestCount >= 8) {
          document.getElementById('requests-info').innerHTML = 
            `<span style="color: #FFC107;">‚ö†Ô∏è –û—Å—Ç–∞–ª–æ—Å—å –º–∞–ª–æ –∑–∞–ø—Ä–æ—Å–æ–≤: ${10 - requestCount}</span>`;
        }
        
        if (requestCount >= 10) {
          document.getElementById('requests-info').innerHTML = 
            `<span style="color: #f44336;">‚ùå –î–æ—Å—Ç–∏–≥–Ω—É—Ç –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (10)</span>`;
        }
      }
      return response;
    };
    
  </script>
</body>
</html>
