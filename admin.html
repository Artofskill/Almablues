<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Panel ‚Äî Chelsea FC KZ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #001028;
      color: #e0e0e0;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    h1, h2 {
      font-family: 'Oswald', sans-serif;
      color: #D4A017;
      text-align: center;
    }
    .container { max-width: 900px; margin: 0 auto; }
    .login-form, .admin-content { max-width: 500px; margin: 40px auto; }
    input, textarea, button, select {
      width: 100%;
      padding: 14px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #444;
      background: #112;
      color: white;
      font-size: 1.1rem;
    }
    button {
      background: #D4A017;
      color: #001028;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover { background: #E8B923; }
    .section { 
      margin: 40px 0; 
      padding: 25px; 
      background: rgba(3,70,148,0.15); 
      border-radius: 12px; 
      border: 1px solid rgba(3,70,148,0.3);
    }
    .event-list, .pending-list { margin-top: 20px; }
    .event-item, .pending-item { 
      background: #0a1a3a; 
      padding: 15px; 
      margin: 12px 0; 
      border-radius: 8px;
      border-left: 4px solid #034694;
    }
    .pending-item { border-left-color: #FFC107; }
    .approved-item { border-left-color: #4CAF50; }
    .hidden { display: none !important; }
    #status, #login-status { 
      text-align: center; 
      margin: 20px 0; 
      font-size: 1.1rem; 
    }
    #login-status { color: #ff6666; }
    .user-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }
    .user-info div {
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 5px;
    }
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .action-buttons button {
      flex: 1;
      padding: 10px;
    }
    .btn-approve {
      background: #4CAF50;
      color: white;
    }
    .btn-reject {
      background: #f44336;
      color: white;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }
    .stat-card {
      background: rgba(3,70,148,0.2);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      color: #D4A017;
    }
    .stat-label {
      font-size: 0.9rem;
      color: #aaa;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Admin Panel ‚Ä¢ Chelsea FC KZ</h1>

    <div id="login-section" class="login-form">
      <h2>–í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
      <input type="text" id="admin-login" placeholder="–õ–æ–≥–∏–Ω" value="Admin">
      <input type="password" id="admin-pass" placeholder="–ü–∞—Ä–æ–ª—å">
      <button id="login-button">–í–æ–π—Ç–∏</button>
      <div id="login-status"></div>
    </div>

    <div id="admin-content" class="hidden">
      <div id="status">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div class="stats" id="stats-section">
        <div class="stat-card">
          <div class="stat-number" id="total-users">0</div>
          <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="pending-applications">0</div>
          <div class="stat-label">–ó–∞—è–≤–æ–∫ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="approved-members">0</div>
          <div class="stat-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö —á–ª–µ–Ω–æ–≤</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="total-events">0</div>
          <div class="stat-label">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</div>
        </div>
      </div>

      <!-- –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
      <div class="section">
        <h2>–°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</h2>
        <input type="text" id="match_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç—á–∞ (Chelsea vs Arsenal)">
        <input type="datetime-local" id="match_date">
        <input type="text" id="bar_address" placeholder="–ê–¥—Ä–µ—Å –±–∞—Ä–∞">
        <textarea id="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è" rows="3"></textarea>
        <input type="number" id="max_participants" placeholder="–ú–∞–∫—Å. —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">
        <label style="display:block; margin:10px 0;">
          <input type="checkbox" id="is_open" checked> –û—Ç–∫—Ä—ã—Ç–∞ –∑–∞–ø–∏—Å—å
        </label>
        <button id="create-event-button">–°–æ–∑–¥–∞—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</button>
      </div>

      <!-- –ó–∞—è–≤–∫–∏ –Ω–∞ Membership -->
      <div class="section">
        <h2>üìã –ó–∞—è–≤–∫–∏ –Ω–∞ Membership</h2>
        <div id="pending-list" class="pending-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <button id="refresh-pending" class="btn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
      </div>

      <!-- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
      <div class="section">
        <h2>üë• –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
        <div style="margin-bottom: 15px;">
          <input type="text" id="search-user" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ username" onkeyup="searchUsers()">
        </div>
        <div id="all-users-list" class="pending-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <button id="refresh-users" class="btn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
      </div>

      <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
      <div class="section">
        <h2>üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</h2>
        <div id="events-list" class="event-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <button id="refresh-events" class="btn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å</button>
      </div>

      <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º -->
      <div class="section">
        <h2>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º</h2>
        <input type="text" id="user-id-input" placeholder="ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
          <input type="number" id="add-points" placeholder="–î–æ–±–∞–≤–∏—Ç—å –æ—á–∫–∏">
          <input type="number" id="remove-points" placeholder="–£–±—Ä–∞—Ç—å –æ—á–∫–∏">
        </div>
        <select id="user-status-select">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞—Ç—É—Å</option>
          <option value="New">New - –ù–æ–≤—ã–π</option>
          <option value="pending">pending - –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</option>
          <option value="approved">approved - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</option>
          <option value="rejected">rejected - –û—Ç–∫–ª–æ–Ω–µ–Ω</option>
        </select>
        <button id="update-user-btn" class="btn">–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
      </div>

      <button id="logout-button" style="background:#c00; margin-top:40px; width:100%;">–í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</button>
    </div>
  </div>

  <script>
    // =============================================
    //   –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SUPABASE
    // =============================================
    const supabaseUrl  = 'https://zuapiixwzkleygaijulx.supabase.co';
    const supabaseKey  = 'sb_publishable_Jsth-2GViNz5Ev3UWtrWTg_fbg4GAKx';
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    const ADMIN_LOGIN = 'Admin';
    const ADMIN_PASS  = '44mnUr8Xz';

    // =============================================
    //   –ü–û–ú–û–ì–ê–Æ–©–ò–ï –§–£–ù–ö–¶–ò–ò
    // =============================================
    function showMsg(id, text, isError = false) {
      const el = document.getElementById(id);
      if (el) {
        el.textContent = text;
        el.style.color = isError ? '#ff6666' : '#88ff88';
      }
    }

    // =============================================
    //   –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
    // =============================================
    function tryLogin() {
      const login = document.getElementById('admin-login')?.value?.trim();
      const pass  = document.getElementById('admin-pass')?.value?.trim();

      if (!login || !pass) {
        showMsg('login-status', '–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å', true);
        return;
      }

      if (login === ADMIN_LOGIN && pass === ADMIN_PASS) {
        localStorage.setItem('adminLoggedIn', 'true');
        document.getElementById('login-section').classList.add('hidden');
        document.getElementById('admin-content').classList.remove('hidden');
        showMsg('status', '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å');
        loadStats();
        loadEvents();
        loadPending();
        loadAllUsers();
      } else {
        showMsg('login-status', '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å', true);
      }
    }

    function logout() {
      localStorage.removeItem('adminLoggedIn');
      location.reload();
    }

    // =============================================
    //   –°–¢–ê–¢–ò–°–¢–ò–ö–ê
    // =============================================
    async function loadStats() {
      try {
        // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        const { count: totalUsers } = await supabaseClient
          .from('users')
          .select('*', { count: 'exact', head: true });
        
        // –ó–∞—è–≤–∫–∏ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏
        const { count: pendingApps } = await supabaseClient
          .from('users')
          .select('*', { count: 'exact', head: true })
          .eq('membership_status', 'pending');
        
        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ —á–ª–µ–Ω—ã
        const { count: approvedMembers } = await supabaseClient
          .from('users')
          .select('*', { count: 'exact', head: true })
          .eq('membership_status', 'approved');
        
        // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
        const { count: totalEvents } = await supabaseClient
          .from('events')
          .select('*', { count: 'exact', head: true });
        
        document.getElementById('total-users').textContent = totalUsers || 0;
        document.getElementById('pending-applications').textContent = pendingApps || 0;
        document.getElementById('approved-members').textContent = approvedMembers || 0;
        document.getElementById('total-events').textContent = totalEvents || 0;
        
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }

    // =============================================
    //   –°–û–ó–î–ê–ù–ò–ï –ú–ï–†–û–ü–†–ò–Ø–¢–ò–Ø
    // =============================================
    async function createEvent() {
      const name   = document.getElementById('match_name')?.value?.trim();
      const date   = document.getElementById('match_date')?.value;
      const addr   = document.getElementById('bar_address')?.value?.trim();
      const desc   = document.getElementById('description')?.value?.trim() || null;
      const max    = parseInt(document.getElementById('max_participants')?.value) || null;
      const open   = document.getElementById('is_open')?.checked ?? true;

      if (!name || !date || !addr) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: –Ω–∞–∑–≤–∞–Ω–∏–µ, –¥–∞—Ç–∞ –∏ –∞–¥—Ä–µ—Å');
        return;
      }

      const { error } = await supabaseClient.from('events').insert({
        match_name: name,
        match_date: new Date(date).toISOString(),
        bar_address: addr,
        description: desc,
        max_participants: max,
        is_open: open
      });

      if (error) {
        alert('–û—à–∏–±–∫–∞: ' + error.message);
      } else {
        alert('‚úÖ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ!');
        document.getElementById('match_name').value = '';
        document.getElementById('match_date').value = '';
        document.getElementById('bar_address').value = '';
        document.getElementById('description').value = '';
        document.getElementById('max_participants').value = '';
        
        loadEvents();
        loadStats();
      }
    }

    // =============================================
    //   –ó–ê–ì–†–£–ó–ö–ê –°–û–ë–´–¢–ò–ô
    // =============================================
    async function loadEvents() {
      const { data, error } = await supabaseClient
        .from('events')
        .select('*')
        .order('match_date', { ascending: true });

      const cont = document.getElementById('events-list');
      
      if (error) {
        cont.innerHTML = '<p style="color: #ff6666;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</p>';
        return;
      }
      
      if (!data?.length) {
        cont.innerHTML = '<p>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –Ω–µ—Ç</p>';
        return;
      }

      cont.innerHTML = '';
      
      data.forEach(ev => {
        const eventDate = new Date(ev.match_date);
        const formattedDate = eventDate.toLocaleDateString('ru-RU', {
          weekday: 'short',
          day: 'numeric',
          month: 'short',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        const d = document.createElement('div');
        d.className = 'event-item';
        d.innerHTML = `
          <strong>${ev.match_name}</strong><br>
          <small>üìÖ ${formattedDate}</small><br>
          <small>üìç ${ev.bar_address}</small><br>
          <small>üë• –ú–∞–∫—Å: ${ev.max_participants || '–Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ'}</small><br>
          <small>${ev.is_open ? '‚úÖ –û—Ç–∫—Ä—ã—Ç–∞ –∑–∞–ø–∏—Å—å' : '‚ùå –ó–∞–ø–∏—Å—å –∑–∞–∫—Ä—ã—Ç–∞'}</small>
          ${ev.description ? `<br><small>üìù ${ev.description}</small>` : ''}
        `;
        cont.appendChild(d);
      });
    }

    // =============================================
    //   –ó–ê–Ø–í–ö–ò –ù–ê –ß–õ–ï–ù–°–¢–í–û
    // =============================================
    async function loadPending() {
      const { data, error } = await supabaseClient
        .from('users')
        .select('id, full_name, username, email, created_at, points, telegram_id')
        .eq('membership_status', 'pending')
        .order('created_at', { ascending: true });

      const cont = document.getElementById('pending-list');
      
      if (error) {
        cont.innerHTML = '<p style="color: #ff6666;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫</p>';
        return;
      }
      
      if (!data?.length) {
        cont.innerHTML = '<p>–ó–∞—è–≤–æ–∫ –Ω–∞ —á–ª–µ–Ω—Å—Ç–≤–æ –Ω–µ—Ç</p>';
        return;
      }

      cont.innerHTML = '';
      
      data.forEach(user => {
        const d = document.createElement('div');
        d.className = 'pending-item';
        d.innerHTML = `
          <div class="user-info">
            <div>
              <strong>üë§ ${user.full_name}</strong><br>
              <small>Telegram: @${user.username || '–Ω–µ —É–∫–∞–∑–∞–Ω'}</small><br>
              <small>ID: ${user.id}</small>
            </div>
            <div>
              <small>üìß ${user.email || '–Ω–µ —É–∫–∞–∑–∞–Ω'}</small><br>
              <small>üìÖ ${new Date(user.created_at).toLocaleDateString('ru-RU')}</small><br>
              <small>‚≠ê –û—á–∫–æ–≤: ${user.points || 0}</small>
            </div>
          </div>
          <div class="action-buttons">
            <button class="btn-approve" onclick="approveApplication('${user.id}')">
              ‚úÖ –û–¥–æ–±—Ä–∏—Ç—å (+100 –æ—á–∫–æ–≤)
            </button>
            <button class="btn-reject" onclick="rejectApplication('${user.id}')">
              ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
            </button>
          </div>
        `;
        cont.appendChild(d);
      });
    }

    // =============================================
    //   –í–°–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò
    // =============================================
    async function loadAllUsers() {
      const { data, error } = await supabaseClient
        .from('users')
        .select('id, full_name, username, email, points, membership_status, created_at')
        .order('created_at', { ascending: false });

      const cont = document.getElementById('all-users-list');
      
      if (error) {
        cont.innerHTML = '<p style="color: #ff6666;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>';
        return;
      }
      
      if (!data?.length) {
        cont.innerHTML = '<p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ—Ç</p>';
        return;
      }

      window.allUsers = data; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –ø–æ–∏—Å–∫–∞
      renderUsers(data);
    }

    function renderUsers(users) {
      const cont = document.getElementById('all-users-list');
      cont.innerHTML = '';
      
      users.forEach(user => {
        const statusColor = {
          'New': '#2196F3',
          'pending': '#FFC107',
          'approved': '#4CAF50',
          'rejected': '#F44336'
        }[user.membership_status] || '#9E9E9E';
        
        const d = document.createElement('div');
        d.className = 'event-item';
        d.style.borderLeftColor = statusColor;
        d.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: start;">
            <div>
              <strong>${user.full_name}</strong><br>
              <small>@${user.username || '–Ω–µ—Ç'}</small><br>
              <small>${user.email || '–Ω–µ—Ç email'}</small>
            </div>
            <div style="text-align: right;">
              <span style="background: ${statusColor}; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;">
                ${user.membership_status}
              </span><br>
              <strong>‚≠ê ${user.points || 0}</strong>
            </div>
          </div>
          <div style="margin-top: 10px; font-size: 0.8rem; color: #aaa;">
            ID: ${user.id} ‚Ä¢ –†–µ–≥: ${new Date(user.created_at).toLocaleDateString('ru-RU')}
          </div>
        `;
        cont.appendChild(d);
      });
    }

    function searchUsers() {
      const searchTerm = document.getElementById('search-user').value.toLowerCase();
      if (!window.allUsers) return;
      
      const filtered = window.allUsers.filter(user => 
        user.full_name?.toLowerCase().includes(searchTerm) ||
        user.username?.toLowerCase().includes(searchTerm) ||
        user.email?.toLowerCase().includes(searchTerm) ||
        user.id?.toLowerCase().includes(searchTerm)
      );
      
      renderUsers(filtered);
    }

    // =============================================
    //   –û–î–û–ë–†–ï–ù–ò–ï –ó–ê–Ø–í–ö–ò
    // =============================================
    async function approveApplication(userId) {
      if (!confirm('–û–¥–æ–±—Ä–∏—Ç—å –∑–∞—è–≤–∫—É –∏ –Ω–∞—á–∏—Å–ª–∏—Ç—å 100 –±–æ–Ω—É—Å–Ω—ã—Ö –æ—á–∫–æ–≤?')) return;
      
      try {
        // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –æ—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const { data: userData, error: fetchError } = await supabaseClient
          .from('users')
          .select('points')
          .eq('id', userId)
          .single();

        if (fetchError) throw fetchError;
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ –æ—á–∫–∏
        const currentPoints = userData.points || 0;
        const newPoints = currentPoints + 100;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏ –æ—á–∫–∏ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
        const { error: updateError } = await supabaseClient
          .from('users')
          .update({ 
            membership_status: 'approved',
            points: newPoints,
            updated_at: new Date().toISOString()
          })
          .eq('id', userId);

        if (updateError) throw updateError;
        
        alert('‚úÖ –ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ–¥–æ–±—Ä–µ–Ω–∞! +100 –æ—á–∫–æ–≤ –Ω–∞—á–∏—Å–ª–µ–Ω—ã.');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Å–ø–∏—Å–∫–∏
        loadPending();
        loadAllUsers();
        loadStats();
        
      } catch (error) {
        alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
        console.error('–û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞—è–≤–∫–∏:', error);
      }
    }

    // =============================================
    //   –û–¢–ö–õ–û–ù–ï–ù–ò–ï –ó–ê–Ø–í–ö–ò
    // =============================================
    async function rejectApplication(userId) {
      if (!confirm('–û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —á–ª–µ–Ω—Å—Ç–≤–æ?')) return;
      
      try {
        const { error } = await supabaseClient
          .from('users')
          .update({ 
            membership_status: 'rejected',
            updated_at: new Date().toISOString()
          })
          .eq('id', userId);

        if (error) throw error;
        
        alert('‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞.');
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Å–ø–∏—Å–∫–∏
        loadPending();
        loadAllUsers();
        loadStats();
        
      } catch (error) {
        alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞—è–≤–∫–∏:', error);
      }
    }

    // =============================================
    //   –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ú
    // =============================================
    async function updateUser() {
      const userId = document.getElementById('user-id-input').value.trim();
      const addPoints = parseInt(document.getElementById('add-points').value) || 0;
      const removePoints = parseInt(document.getElementById('remove-points').value) || 0;
      const newStatus = document.getElementById('user-status-select').value;
      
      if (!userId) {
        alert('–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
        return;
      }
      
      if (!addPoints && !removePoints && !newStatus) {
        alert('–£–∫–∞–∂–∏—Ç–µ —á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å: –æ—á–∫–∏ –∏–ª–∏ —Å—Ç–∞—Ç—É—Å');
        return;
      }
      
      try {
        // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const { data: userData, error: fetchError } = await supabaseClient
          .from('users')
          .select('points')
          .eq('id', userId)
          .single();
        
        if (fetchError) throw fetchError;
        
        const updates = {};
        const currentPoints = userData.points || 0;
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ –æ—á–∫–∏
        if (addPoints > 0 || removePoints > 0) {
          updates.points = currentPoints + addPoints - removePoints;
          if (updates.points < 0) updates.points = 0;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
        if (newStatus) {
          updates.membership_status = newStatus;
        }
        
        updates.updated_at = new Date().toISOString();
        
        const { error } = await supabaseClient
          .from('users')
          .update(updates)
          .eq('id', userId);
        
        if (error) throw error;
        
        alert('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
        
        // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
        document.getElementById('user-id-input').value = '';
        document.getElementById('add-points').value = '';
        document.getElementById('remove-points').value = '';
        document.getElementById('user-status-select').value = '';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–∫–∏
        loadPending();
        loadAllUsers();
        loadStats();
        
      } catch (error) {
        alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
      }
    }

    // =============================================
    //   –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–û–ë–´–¢–ò–ô –ù–ê –°–¢–†–ê–ù–ò–¶–ï
    // =============================================
    document.addEventListener('DOMContentLoaded', () => {
      // –ö–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞
      document.getElementById('login-button')?.addEventListener('click', tryLogin);

      // –ö–Ω–æ–ø–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∞–¥–º–∏–Ω–∫–∏
      document.getElementById('create-event-button')?.addEventListener('click', createEvent);
      document.getElementById('refresh-pending')?.addEventListener('click', loadPending);
      document.getElementById('refresh-events')?.addEventListener('click', loadEvents);
      document.getElementById('refresh-users')?.addEventListener('click', loadAllUsers);
      document.getElementById('update-user-btn')?.addEventListener('click', updateUser);
      document.getElementById('logout-button')?.addEventListener('click', logout);

      // –ê–≤—Ç–æ–≤—Ö–æ–¥ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–µ—Å—Å–∏–∏
      if (localStorage.getItem('adminLoggedIn') === 'true') {
        document.getElementById('login-section').classList.add('hidden');
        document.getElementById('admin-content').classList.remove('hidden');
        showMsg('status', '‚úÖ –ê–≤—Ç–æ–≤—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
        loadStats();
        loadEvents();
        loadPending();
        loadAllUsers();
      }
    });
  </script>
</body>
</html>
