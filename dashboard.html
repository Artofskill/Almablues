<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard ‚Äî Chelsea FC KZ</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root {
      --bg-dark: #001028;
      --chelsea-blue: #034694;
      --chelsea-blue-dark: #002366;
      --gold: #D4A017;
      --gold-hover: #E8B923;
      --text-light: #e0e0e0;
      --white: #ffffff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background: var(--bg-dark);
      color: var(--text-light);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 2rem;
    }

    h1 {
      font-family: 'Oswald', sans-serif;
      color: var(--gold);
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .user-info {
      background: rgba(3, 70, 148, 0.2);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .user-name {
      font-weight: bold;
      font-size: 1.1rem;
    }

    .user-points {
      background: var(--gold);
      color: var(--bg-dark);
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin-bottom: 2rem;
    }

    .section-title {
      font-family: 'Oswald', sans-serif;
      font-size: 1.5rem;
      color: var(--gold);
      margin-bottom: 1rem;
      padding-bottom: 5px;
      border-bottom: 2px solid var(--chelsea-blue);
    }

    .card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 20px;
      transition: transform 0.2s;
    }

    .card:hover {
      transform: translateY(-2px);
      background: rgba(255, 255, 255, 0.08);
    }

    .card-title {
      font-family: 'Oswald', sans-serif;
      font-size: 1.2rem;
      color: var(--white);
      margin-bottom: 10px;
    }

    .card-description {
      color: #aaa;
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .btn {
      display: block;
      width: 100%;
      padding: 14px;
      background: var(--chelsea-blue);
      color: var(--white);
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      transition: background 0.2s;
    }

    .btn:hover {
      background: var(--chelsea-blue-dark);
    }

    .btn-gold {
      background: var(--gold);
      color: var(--bg-dark);
    }

    .btn-gold:hover {
      background: var(--gold-hover);
    }

    .btn-small {
      padding: 8px 16px;
      font-size: 0.9rem;
    }

    .events-list {
      margin-top: 10px;
    }

    .event-item {
      background: rgba(3, 70, 148, 0.1);
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .event-info h4 {
      color: var(--white);
      margin-bottom: 5px;
    }

    .event-date {
      color: var(--gold);
      font-size: 0.9rem;
    }

    footer {
      text-align: center;
      margin-top: 3rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: #777;
      font-size: 0.9rem;
    }

    .back-btn {
      display: inline-block;
      margin-top: 1rem;
      color: var(--gold);
      text-decoration: none;
      font-weight: 500;
    }

    .back-btn:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
<div class="container">
  <header>
    <h1>Chelsea FC KZ</h1>
    <p>–§–∞–Ω-–∫–ª—É–± –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ</p>
  </header>

  <div class="user-info">
    <div>
      <div class="user-name" id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      <div id="user-status" style="font-size: 0.9rem; color: #aaa;">–°—Ç–∞—Ç—É—Å: New</div>
    </div>
    <div class="user-points">
      <span id="user-points">0</span> –æ—á–∫–æ–≤
    </div>
  </div>

  <div class="dashboard-grid">
    
    <!-- –ó–∞—è–≤–∫–∞ –Ω–∞ —á–ª–µ–Ω—Å—Ç–≤–æ -->
    <div class="card">
      <h3 class="card-title">üë• –ó–∞—è–≤–∫–∞ –Ω–∞ —á–ª–µ–Ω—Å—Ç–≤–æ</h3>
      <p class="card-description">–ü–æ–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ —á–ª–µ–Ω—Å—Ç–≤–æ –≤ —Ñ–∞–Ω-–∫–ª—É–±–µ</p>
      <button class="btn btn-gold" id="membership-btn">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
    </div>

    <!-- –†–µ–π—Ç–∏–Ω–≥–∏ -->
    <div class="card">
      <h3 class="card-title">üèÜ –†–µ–π—Ç–∏–Ω–≥–∏</h3>
      <p class="card-description">–¢–æ–ø –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ñ–∞–Ω-–∫–ª—É–±–∞</p>
      <button class="btn" id="ratings-btn">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–π—Ç–∏–Ω–≥</button>
    </div>

    <!-- –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
    <div class="card">
      <h3 class="card-title">üìÖ –ë–ª–∏–∂–∞–π—à–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h3>
      <p class="card-description">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –º–∞—Ç—á–∏ –∏ –≤—Å—Ç—Ä–µ—á–∏ —Ñ–∞–Ω–∞—Ç–æ–≤</p>
      
      <div class="events-list">
        <div class="event-item">
          <div class="event-info">
            <h4>Chelsea vs Man City</h4>
            <div class="event-date">15 –º–∞—Ä—Ç–∞ 2025 ‚Ä¢ 20:00</div>
          </div>
          <button class="btn btn-small" onclick="registerEvent(1)">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
        </div>
        
        <div class="event-item">
          <div class="event-info">
            <h4>–í—Å—Ç—Ä–µ—á–∞ —Ñ–∞–Ω–∞—Ç–æ–≤</h4>
            <div class="event-date">22 –º–∞—Ä—Ç–∞ 2025 ‚Ä¢ 18:00</div>
          </div>
          <button class="btn btn-small" onclick="registerEvent(2)">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
        </div>
      </div>
      
      <button class="btn" id="all-events-btn" style="margin-top: 15px;">–í—Å–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</button>
    </div>

    <!-- –ú–æ–∏ –∑–∞–ø–∏—Å–∏ -->
    <div class="card">
      <h3 class="card-title">üé´ –ú–æ–∏ –∑–∞–ø–∏—Å–∏</h3>
      <p class="card-description">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–∏–º–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è–º–∏ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</p>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
        <button class="btn btn-small" id="my-registrations-btn">–ú–æ–∏ –∑–∞–ø–∏—Å–∏</button>
        <button class="btn btn-small" id="edit-registration-btn">–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
      </div>
    </div>

    <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ -->
    <div class="card">
      <h3 class="card-title">üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
      <p class="card-description">–°–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</p>
      <button class="btn" id="participants-btn">–ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–ø–∏—Å–∞–≤—à–∏—Ö—Å—è</button>
    </div>

    <!-- QR –∫–æ–¥ -->
    <div class="card">
      <h3 class="card-title">üì± QR –∫–æ–¥</h3>
      <p class="card-description">–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π QR –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö</p>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
        <button class="btn btn-small" id="show-qr-btn">–ü–æ–∫–∞–∑–∞—Ç—å –º–æ–π QR</button>
        <button class="btn btn-small" id="scan-qr-btn">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR</button>
      </div>
    </div>

  </div>

  <footer>
    <p>Chelsea FC Supporters Club Kazakhstan ‚Ä¢ 2025</p>
    <a href="profile.html" class="back-btn">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –ø—Ä–æ—Ñ–∏–ª—å</a>
  </footer>
</div>

<script>
  // === Telegram ===
  const tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand();

  // === Supabase ===
  const supabaseUrl = 'https://zuapiixwzkleygaijulx.supabase.co';
  const supabaseKey = 'sb_publishable_Jsth-2GViNz5Ev3UWtrWTg_fbg4GAKx';

  const supabaseClient = supabase.createClient(
    supabaseUrl,
    supabaseKey
  );

  const userId = localStorage.getItem('userId');

  if (!userId) {
    alert('–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
    location.href = 'index.html';
  }

  // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  async function loadUserData() {
    try {
      const { data, error } = await supabaseClient
        .from('users')
        .select('full_name, points, membership_status')
        .eq('id', userId)
        .single();

      if (error || !data) {
        console.error('Error loading user:', error);
        return;
      }

      document.getElementById('user-name').textContent = data.full_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
      document.getElementById('user-points').textContent = data.points || 0;
      document.getElementById('user-status').textContent = `–°—Ç–∞—Ç—É—Å: ${data.membership_status || 'New'}`;
    } catch (err) {
      console.error('Unexpected error:', err);
    }
  }

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ (–∑–∞–≥–ª—É—à–∫–∏)
  function setupButtonHandlers() {
    // –ó–∞—è–≤–∫–∞ –Ω–∞ —á–ª–µ–Ω—Å—Ç–≤–æ
    document.getElementById('membership-btn').addEventListener('click', () => {
      alert('–§—É–Ω–∫—Ü–∏—è "–ó–∞—è–≤–∫–∞ –Ω–∞ —á–ª–µ–Ω—Å—Ç–≤–æ" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    });

    // –†–µ–π—Ç–∏–Ω–≥–∏
    document.getElementById('ratings-btn').addEventListener('click', () => {
      alert('–§—É–Ω–∫—Ü–∏—è "–†–µ–π—Ç–∏–Ω–≥–∏" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    });

    // –í—Å–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
    document.getElementById('all-events-btn').addEventListener('click', () => {
      alert('–§—É–Ω–∫—Ü–∏—è "–í—Å–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    });

    // –ú–æ–∏ –∑–∞–ø–∏—Å–∏
    document.getElementById('my-registrations-btn').addEventListener('click', () => {
      alert('–§—É–Ω–∫—Ü–∏—è "–ú–æ–∏ –∑–∞–ø–∏—Å–∏" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    });

    // –ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å
    document.getElementById('edit-registration-btn').addEventListener('click', () => {
      alert('–§—É–Ω–∫—Ü–∏—è "–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    });

    // –£—á–∞—Å—Ç–Ω–∏–∫–∏
    document.getElementById('participants-btn').addEventListener('click', () => {
      alert('–§—É–Ω–∫—Ü–∏—è "–ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–ø–∏—Å–∞–≤—à–∏—Ö—Å—è" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    });

    // –ü–æ–∫–∞–∑–∞—Ç—å QR
    document.getElementById('show-qr-btn').addEventListener('click', () => {
      alert('–§—É–Ω–∫—Ü–∏—è "–ü–æ–∫–∞–∑–∞—Ç—å –º–æ–π QR" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    });

    // –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR
    document.getElementById('scan-qr-btn').addEventListener('click', () => {
      alert('–§—É–Ω–∫—Ü–∏—è "–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
    });
  }

  // –ó–∞–ø–∏—Å—å –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ
  function registerEvent(eventId) {
    alert(`–í—ã –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ #${eventId}. –§—É–Ω–∫—Ü–∏—è –∑–∞–ø–∏—Å–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.`);
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  loadUserData();
  setupButtonHandlers();
</script>
</body>
</html>
